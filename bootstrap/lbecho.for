      SUBROUTINE GETLNH (ILINE,MLEN)
      IMPLICIT NONE
      INTEGER N,MLEN,ILEN
      LOGICAL*1 ILINE(100),WORK(100)
      LOGICAL*1 ICHAR,LCHAR
      ILEN =0
23000 IF(.NOT.(.TRUE.))GOTO 23001
      IF(.NOT.(ILEN.LE.0))GOTO 23002
      ILEN =0
      LCHAR =0
      GOTO 23003
23002 CONTINUE
      LCHAR =WORK(ILEN)
23003 CONTINUE
      WORK(ILEN+1) =0
      CALL GET_CH (ICHAR,0)
      IF(.NOT.(ICHAR.EQ.3.OR.ICHAR.EQ.11))GOTO 23004
      ILINE(1) =-1
      RETURN
23004 CONTINUE
      IF(.NOT.(ICHAR.EQ.13.OR.ICHAR.EQ.10))GOTO 23006
      CALL ECHOR
      GOTO 23001
23006 CONTINUE
      IF(.NOT.(ICHAR.EQ.18))GOTO 23008
      CALL ECHOR
      CALL ECHOH (WORK,ILEN)
      GOTO 23000
23008 CONTINUE
      IF(.NOT.(ICHAR.EQ.24.OR.ICHAR.EQ.21))GOTO 23010
23012 IF(.NOT.(ILEN.GE.0))GOTO 23013
      CALL ECHO(8)
      CALL ECHO(32)
      CALL ECHO(8) 
      ILEN =ILEN -1
      GOTO 23012
23013 CONTINUE
      ILEN =0
      GOTO 23000
23010 CONTINUE
      IF(.NOT.(ICHAR.EQ.23))GOTO 23014
      IF(.NOT.(ILEN.LE.0))GOTO 23016
      CALL ECHO (7)
      GOTO 23000
23016 CONTINUE
23018 IF(.NOT.(.TRUE.))GOTO 23019
      WORK(ILEN) =0
      CALL ECHO(8)
      CALL ECHO(32)
      CALL ECHO(8) 
      ILEN =ILEN -1
      IF(.NOT.(ILEN.LE.0))GOTO 23020
      GOTO 23019
23020 CONTINUE
      IF(.NOT.(WORK(ILEN).EQ.32))GOTO 23022
      GOTO 23019
23022 CONTINUE
      GOTO 23018
23019 CONTINUE
      GOTO 23000
23014 CONTINUE
      IF(.NOT.(ICHAR.EQ.1.OR.ICHAR.EQ.8.OR.ICHAR.EQ.127))GOTO 23024
      IF(.NOT.(ILEN.LE.0))GOTO 23026
      CALL ECHO (7)
      GOTO 23000
23026 CONTINUE
      CALL ECHO(8)
      CALL ECHO(32)
      CALL ECHO(8) 
      WORK(ILEN) =0
      ILEN =ILEN -1
      GOTO 23000
23024 CONTINUE
      IF(.NOT.(ICHAR.LT.32))GOTO 23028
      CALL ECHO (7)
      GOTO 23000
23028 CONTINUE
      IF(.NOT.(ILEN.GE.MLEN))GOTO 23030
      CALL ECHOV (' Confirm with carriage return')
      CALL ECHOR
      CALL ECHOH (WORK,ILEN)
      GOTO 23031
23030 CONTINUE
      IF(.NOT.(ILEN.EQ.0.AND.ICHAR.EQ.32))GOTO 23032
      GOTO 23000
23032 CONTINUE
      ILEN =ILEN +1
      WORK(ILEN) =ICHAR
      CALL ECHO (ICHAR)
23033 CONTINUE
23031 CONTINUE
23029 CONTINUE
23025 CONTINUE
23015 CONTINUE
23011 CONTINUE
23009 CONTINUE
23007 CONTINUE
23005 CONTINUE
      GOTO 23000
23001 CONTINUE
      N=1
23034 IF(.NOT.(N.LE.MLEN))GOTO 23036
      IF(.NOT.(N.LE.ILEN))GOTO 23037
      ICHAR =WORK(N)
      GOTO 23038
23037 CONTINUE
      ICHAR =32
23038 CONTINUE
      ILINE(N) =ICHAR
23035 N=N+1
      GOTO 23034
23036 CONTINUE
      ILINE(MLEN+1) =0
      RETURN
      END
      SUBROUTINE GETLNH_R (HANDLE,ILINE,MLEN)
      IMPLICIT NONE
      INTEGER N,ILEN,MLEN
      INTEGER HANDLE
      INTEGER*4 NULLS
      LOGICAL*1 ILINE(100),WORK(100)
      LOGICAL*1 ICHAR2,ICHAR3,ICHAR,LCHAR
      ILEN =0
23039 IF(.NOT.(.TRUE.))GOTO 23040
      IF(.NOT.(ILEN.LE.0))GOTO 23041
      ILEN =0
      LCHAR =0
      GOTO 23042
23041 CONTINUE
      LCHAR =WORK(ILEN)
23042 CONTINUE
      WORK(ILEN+1) =0
      CALL GET_CH (ICHAR,0)
      IF(.NOT.(ICHAR.NE.0))GOTO 23043
      NULLS =0
      GOTO 23044
23043 CONTINUE
      NULLS =NULLS +1
      IF(.NOT.(NULLS.GT.1000))GOTO 23045
      N=1
23047 IF(.NOT.(N.LE.MLEN))GOTO 23049
      ILINE(N) =0
23048 N=N+1
      GOTO 23047
23049 CONTINUE
      ILINE(1) =-1
      RETURN
23045 CONTINUE
23044 CONTINUE
      IF(.NOT.(ICHAR.EQ.3.OR.ICHAR.EQ.11))GOTO 23050
      ILINE(1) =-1
      RETURN
23050 CONTINUE
      IF(.NOT.(ICHAR.EQ.13.OR.ICHAR.EQ.10))GOTO 23052
      CALL ECHOR
      GOTO 23040
23052 CONTINUE
      IF(.NOT.(ICHAR.EQ.18))GOTO 23054
      CALL ECHOR
      CALL ECHOH (WORK,ILEN)
      GOTO 23039
23054 CONTINUE
      IF(.NOT.(ICHAR.EQ.24.OR.ICHAR.EQ.21))GOTO 23056
23058 IF(.NOT.(ILEN.GE.0))GOTO 23059
      CALL ECHO(8)
      CALL ECHO(32)
      CALL ECHO(8) 
      ILEN =ILEN -1
      GOTO 23058
23059 CONTINUE
      ILEN =0
      GOTO 23039
23056 CONTINUE
      IF(.NOT.(ICHAR.EQ.23))GOTO 23060
      IF(.NOT.(ILEN.LE.0))GOTO 23062
      CALL ECHO (7)
      GOTO 23039
23062 CONTINUE
23064 IF(.NOT.(.TRUE.))GOTO 23065
      WORK(ILEN) =0
      CALL ECHO(8)
      CALL ECHO(32)
      CALL ECHO(8) 
      ILEN =ILEN -1
      IF(.NOT.(ILEN.LE.0))GOTO 23066
      GOTO 23065
23066 CONTINUE
      IF(.NOT.(WORK(ILEN).EQ.32))GOTO 23068
      GOTO 23065
23068 CONTINUE
      GOTO 23064
23065 CONTINUE
      GOTO 23039
23060 CONTINUE
      IF(.NOT.(ICHAR.EQ.1.OR.ICHAR.EQ.8.OR.ICHAR.EQ.127))GOTO 23070
      IF(.NOT.(ILEN.LE.0))GOTO 23072
      CALL ECHO (7)
      GOTO 23039
23072 CONTINUE
      CALL ECHO(8)
      CALL ECHO(32)
      CALL ECHO(8) 
      WORK(ILEN) =0
      ILEN =ILEN -1
      GOTO 23039
23070 CONTINUE
      IF(.NOT.(HANDLE.NE.0.AND.ICHAR.EQ.27))GOTO 23074
      CALL GET_CH (ICHAR2,0)
      CALL GET_CH (ICHAR3,0)
      IF(.NOT.(ICHAR2.EQ.91.AND.ICHAR3.EQ.65))GOTO 23076
      CALL ECHOR
      CALL TTYOUT_FLUSH
      CALL RECALL_LINE (HANDLE,-1,WORK,ILEN,0,0)
      CALL ECHO(13)
      CALL ECHOH(WORK,ILEN)
      CALL ECHOR
      GOTO 23040
23076 CONTINUE
      CALL ECHO (7)
23077 CONTINUE
      GOTO 23039
23074 CONTINUE
      IF(.NOT.(ICHAR.LT.32))GOTO 23078
      CALL ECHO (7)
      GOTO 23039
23078 CONTINUE
      IF(.NOT.(ILEN.GE.MLEN))GOTO 23080
      CALL ECHOV (' Confirm with carriage return')
      CALL ECHOR
      CALL ECHOH (WORK,ILEN)
      GOTO 23081
23080 CONTINUE
      IF(.NOT.(ILEN.EQ.0.AND.ICHAR.EQ.32))GOTO 23082
      GOTO 23039
23082 CONTINUE
      ILEN =ILEN +1
      WORK(ILEN) =ICHAR
      CALL ECHO (ICHAR)
23083 CONTINUE
23081 CONTINUE
23079 CONTINUE
23075 CONTINUE
23071 CONTINUE
23061 CONTINUE
23057 CONTINUE
23055 CONTINUE
23053 CONTINUE
23051 CONTINUE
      GOTO 23039
23040 CONTINUE
      N=1
23084 IF(.NOT.(N.LE.MLEN))GOTO 23086
      IF(.NOT.(N.LE.ILEN))GOTO 23087
      ICHAR =WORK(N)
      GOTO 23088
23087 CONTINUE
      ICHAR =32
23088 CONTINUE
      ILINE(N) =ICHAR
23085 N=N+1
      GOTO 23084
23086 CONTINUE
      ILINE(MLEN+1) =0
      RETURN
      END
      SUBROUTINE GETFCH (CHAR,IDLY,IARG)
      IMPLICIT NONE
      INTEGER IDLY,IARG,IBRK
      INTEGER XJFN,XSOURC(2),XOLDIN,X7READ
      INTEGER ZSTAT
      INTEGER XJFN2,XNEW,X7WRIT
      INTEGER COMMNT
      INTEGER XSTAT
      INTEGER XERR
      INTEGER NSKIP
      LOGICAL*1 CHAR,LCHAR
      COMMON /CGETCH/ XJFN,XSTAT
      DATA XSTAT /'TTY'/
      DATA XJFN /5/
      DATA XSOURC/5,6/
      DATA XERR /'TTY'/
      DATA XOLDIN/3/
      DATA X7READ/5/
      DATA XJFN2 /6/
      DATA XNEW/1/
      DATA X7WRIT/6/
      DATA NSKIP/0/
      SAVE LCHAR
      CALL ECHOP ('CLR ')
      IF(.NOT.(XSTAT.EQ.'END'))GOTO 23089
      XSTAT ='TTY'
      CALL ECHOV ('  [Input from file completed]')
      CHAR =18
      GOTO 23090
23089 CONTINUE
      IF(.NOT.(XSTAT.EQ.'TTY'.OR.XSTAT.EQ.'TTYB'))GOTO 23091
      IF(.NOT.(IDLY.EQ.1))GOTO 23093
      CALL TTYIN (CHAR,IARG)
      GOTO 23094
23093 CONTINUE
      CALL TTYDLY (CHAR,IARG)
23094 CONTINUE
      IF(.NOT.(CHAR.EQ.5))GOTO 23095
1230  CALL ECHOV ('^e [Control: ')
      CALL TTYIN (CHAR,0)
      IF(.NOT.(CHAR.EQ.110.OR.CHAR.EQ.78))GOTO 23097
      CALL ECHOV ('No ')
23099 IF(.NOT.(.TRUE.))GOTO 23100
      CALL TTYIN (CHAR,0)
      IF(.NOT.(CHAR.NE.0))GOTO 23101
      GOTO 23100
23101 CONTINUE
      GOTO 23099
23100 CONTINUE
      IF(.NOT.(CHAR.EQ.112.OR.CHAR.EQ.80))GOTO 23103
      CALL ECHOV ('Page mode')
      CALL ECHOP ('FOFF')
      GOTO 23104
23103 CONTINUE
      IF(.NOT.(CHAR.EQ.116.OR.CHAR.EQ.84))GOTO 23105
      CALL ECHOV ('Typescript')
      CALL ECHOP ('NTEE')
      GOTO 23106
23105 CONTINUE
      IF(.NOT.(CHAR.EQ.63))GOTO 23107
      CALL ECHOV ('?  one of these:')
      CALL ECHOV (' Pagemode, Typescript')
      CALL ECHOR
      GOTO 1230
81230 CONTINUE
      GOTO 23108
23107 CONTINUE
      CALL ECHO (CHAR)
      CALL ECHOV (' invalid')
23108 CONTINUE
23106 CONTINUE
23104 CONTINUE
      GOTO 23098
23097 CONTINUE
      IF(.NOT.(CHAR.EQ.99.OR.CHAR.EQ.67))GOTO 23109
      CALL ECHOV ('Continue typescript')
      CALL ECHOP ('CTEE')
      GOTO 23110
23109 CONTINUE
      IF(.NOT.(CHAR.EQ.116.OR.CHAR.EQ.84))GOTO 23111
      CALL ECHOV ('Typescript to file ')
      CALL FCLOSF (XJFN2,0,XERR)
      CALL FGTJFN (XJFN2,XSOURC,XNEW,XERR,*9000)
      CALL FOPENF (XJFN2,X7WRIT,XERR,*9000)
      CALL ECHOP_TEE (XJFN2)
      CHAR =13
      RETURN
23111 CONTINUE
      IF(.NOT.(CHAR.EQ.112.OR.CHAR.EQ.80))GOTO 23113
      CALL ECHOV ('Page mode')
      CALL ECHOP ('FON ')
      GOTO 23114
23113 CONTINUE
      IF(.NOT.(CHAR.EQ.107.OR.CHAR.EQ.75))GOTO 23115
      CALL ECHOV ('Klose typescript')
      CALL ECHOP ('NTEE')
      CALL FCLOSF (XJFN2,0,XERR)
      GOTO 23116
23115 CONTINUE
      IF(.NOT.(CHAR.EQ.50))GOTO 23117
      CALL ECHOV ('22 lines/page')
      CALL ECHOP ('P22 ')
      GOTO 23118
23117 CONTINUE
      IF(.NOT.(CHAR.EQ.51))GOTO 23119
      CALL ECHOV ('38 lines/page')
      CALL ECHOP ('P38 ')
      GOTO 23120
23119 CONTINUE
      IF(.NOT.(CHAR.EQ.63))GOTO 23121
      CALL ECHOV ('?  one of these:')
      CALL ECHOR
      CALL ECHOV ('  Typescript')
      CALL ECHOR
      CALL ECHOV ('  No Typescript')
      CALL ECHOR
      CALL ECHOV ('  Continue typescript')
      CALL ECHOR
      CALL ECHOV ('  Klose typescript')
      CALL ECHOR
      CALL ECHOV ('  Pagemode')
      CALL ECHOR
      CALL ECHOV ('  No Pagemode')
      CALL ECHOR
      CALL ECHOV ('  22 lines/page')
      CALL ECHOR
      CALL ECHOV ('  33 lines/page')
      CALL ECHOR
      GOTO 1230
91230 CONTINUE
      GOTO 23122
23121 CONTINUE
      IF(.NOT.(CHAR.LE.26))GOTO 23123
      CALL ECHO (94)
      CALL ECHO (CHAR+65-1)
      CALL ECHO (93)
      RETURN
23123 CONTINUE
      CALL ECHO (CHAR)
      CALL ECHOV (' invalid')
23124 CONTINUE
23122 CONTINUE
23120 CONTINUE
23118 CONTINUE
23116 CONTINUE
23114 CONTINUE
23112 CONTINUE
23110 CONTINUE
23098 CONTINUE
      CALL ECHO (93)
      CHAR =18
      GOTO 23096
23095 CONTINUE
      IF(.NOT.(CHAR.EQ.6))GOTO 23125
      CALL ECHOV ('^f  [Input from file: ')
      CALL FCLOSF (XJFN,0,XERR)
      CALL FGTJFN (XJFN,XSOURC,XOLDIN,XERR,*8000)
      CALL FOPENF (XJFN,X7READ,XERR,*8000)
      CALL ECHOV (' ok]')
      XSTAT ='DSK'
      CHAR =18
      LCHAR =32
      GOTO 23126
23125 CONTINUE
      IF(.NOT.(CHAR.EQ.7))GOTO 23127
      CALL ECHOV ('^g  [')
      IF(.NOT.(XSTAT.NE.'TTYB'))GOTO 23129
      CALL ECHOV ('Input from command file cannot be continued]')
      GOTO 23130
23129 CONTINUE
      CALL ECHOV ('Continuing input from command file]')
      XSTAT ='DSK'
23130 CONTINUE
      CHAR =18
23127 CONTINUE
23126 CONTINUE
23096 CONTINUE
      GOTO 23092
23091 CONTINUE
      IBRK =0
      NSKIP =NSKIP +1
      IF(.NOT.(NSKIP.GE.100))GOTO 23131
      NSKIP =0
23133 CONTINUE
      CHAR =0
      IF(.NOT.(CHAR.EQ.2))GOTO 23136
      IBRK =1
23136 CONTINUE
      IF(.NOT.(CHAR.EQ.11))GOTO 23138
      GOTO 8020
88020 CONTINUE
23138 CONTINUE
23134 IF(.NOT.(CHAR.EQ.0))GOTO 23133
23135 CONTINUE
23131 CONTINUE
      IF(.NOT.(IBRK.EQ.1))GOTO 23140
      CALL ECHOV ('^b  [Command file hold, ^g to go]')
      XSTAT ='TTYB'
      CHAR =18
      RETURN
23140 CONTINUE
      CHAR =LCHAR
      COMMNT =0
23142 IF(.NOT.(.TRUE.))GOTO 23143
      LCHAR =CHAR
      CALL FBIN (XJFN,CHAR,XERR,*8010)
      IF(.NOT.(CHAR.EQ.0))GOTO 23144
      GOTO 8010
88010 CONTINUE
      GOTO 23145
23144 CONTINUE
      IF(.NOT.(CHAR.EQ.10))GOTO 23146
      COMMNT =0
      GOTO 23147
23146 CONTINUE
      IF(.NOT.(CHAR.EQ.35))GOTO 23148
      COMMNT =1
      GOTO 23149
23148 CONTINUE
      IF(.NOT.(CHAR.EQ.33))GOTO 23150
      COMMNT =1+1
      GOTO 23151
23150 CONTINUE
      IF(.NOT.(CHAR.EQ.9))GOTO 23152
      CHAR =32
23152 CONTINUE
23151 CONTINUE
23149 CONTINUE
23147 CONTINUE
23145 CONTINUE
      IF(.NOT.(COMMNT.EQ.1+1))GOTO 23154
      CALL ECHO (CHAR)
23154 CONTINUE
      IF(.NOT.(COMMNT.NE.0))GOTO 23156
      CHAR =32
23156 CONTINUE
      IF(.NOT.(LCHAR.NE.32.OR.CHAR.NE.32))GOTO 23158
      IF(.NOT.(CHAR.EQ.10))GOTO 23160
      LCHAR =32
      GOTO 23161
23160 CONTINUE
      LCHAR =CHAR
23161 CONTINUE
      GOTO 23143
23158 CONTINUE
      GOTO 23142
23143 CONTINUE
      IF(.NOT.(CHAR.EQ.2))GOTO 23162
      CALL ECHOV ('^b  [Command file pause, ^g to go]')
      XSTAT ='TTYB'
      CHAR =18
23162 CONTINUE
23092 CONTINUE
23090 CONTINUE
      RETURN
8000  CALL TYPERR (XERR)
      CALL ECHOV ('   Input from that file is impossible]')
      CHAR =13
      XSTAT ='TTY'
      GO TO 8999
8010  CHAR =13
      GO TO 8998
8020  CHAR =11
8998  XSTAT ='END'
8999  CALL FCLOSF (XJFN,0,XERR)
      XJFN =-1
      RETURN
9000  CALL TYPERR (XERR)
      CALL ECHOP ('NTEE')
      CALL ECHOV ('   Output to that file is impossible]')
      CHAR =18
      CALL FCLOSF (XJFN2,0,XERR)
      RETURN
      ENTRY GET_GETFCH_SOURCE (ZSTAT)
      ZSTAT =XSTAT
      RETURN
      END
      SUBROUTINE ECHOH (HSTRNG,LEN)
      IMPLICIT NONE
      INTEGER I,LEN,JLEN,LENGTH
      LOGICAL*1 CHAR
      LOGICAL*1 HSTRNG(100)
      IF(.NOT.(LEN.NE.0))GOTO 23164
      JLEN =LEN
      GOTO 23165
23164 CONTINUE
      JLEN =LENGTH(HSTRNG)
23165 CONTINUE
      I=1
23166 IF(.NOT.(I.LE.JLEN))GOTO 23168
      CHAR =HSTRNG(I)
      IF(.NOT.(CHAR.EQ.0))GOTO 23169
      GOTO 23168
23169 CONTINUE
      CALL ECHO(CHAR)
23167 I=I+1
      GOTO 23166
23168 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOVT (VAXCHAR)
      IMPLICIT NONE
      CHARACTER *(*) VAXCHAR
      INTEGER KK
      KK =LEN(VAXCHAR)
23171 IF(.NOT.(KK.GT.1.AND.VAXCHAR(KK:KK).EQ.''))GOTO 23172
      KK =KK -1
      GOTO 23171
23172 CONTINUE
      CALL ECHOV (VAXCHAR(1:KK))
      RETURN
      END
      SUBROUTINE ECHOV (VAXCHAR)
      IMPLICIT NONE
      INTEGER I,JLEN,LEN
      LOGICAL*1 CHAR,TERM1,TERM2
      CHARACTER *(*) VAXCHAR
      TERM1 =0
      TERM2 =0
      GOTO 6001
      ENTRY ECHOVN (VAXCHAR)
      TERM1 =0
      TERM2 =32
6001  JLEN =LEN(VAXCHAR)
      I=1
23173 IF(.NOT.(I.LE.JLEN))GOTO 23175
      CHAR =ICHAR(VAXCHAR(I:I))
      IF(.NOT.(CHAR.EQ.TERM1.OR.CHAR.EQ.TERM2))GOTO 23176
      GOTO 23175
23176 CONTINUE
      CALL ECHO(CHAR)
23174 I=I+1
      GOTO 23173
23175 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOHP (HSTRNG,LEN)
      IMPLICIT NONE
      INTEGER I,LEN
      LOGICAL*1 CHAR
      LOGICAL*1 HSTRNG(100)
      I=1
23178 IF(.NOT.(I.LE.LEN))GOTO 23180
      CHAR =HSTRNG(I)
      IF(.NOT.(CHAR.EQ.0))GOTO 23181
      CHAR =32
      GOTO 23182
23181 CONTINUE
      IF(.NOT.(CHAR.LT.32))GOTO 23183
      CONTINUE
23183 CONTINUE
23182 CONTINUE
      CALL ECHO(CHAR)
23179 I=I+1
      GOTO 23178
23180 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOHN (HSTRNG,LEN)
      IMPLICIT NONE
      INTEGER I,LEN
      LOGICAL*1 CHAR
      LOGICAL*1 HSTRNG(100)
      I=1
23185 IF(.NOT.(I.LE.LEN))GOTO 23187
      CHAR =HSTRNG(I)
      IF(.NOT.(CHAR.EQ.32))GOTO 23188
      GOTO 23187
23188 CONTINUE
      IF(.NOT.(CHAR.EQ.0))GOTO 23190
      GOTO 23187
23190 CONTINUE
      CALL ECHO(CHAR)
23186 I=I+1
      GOTO 23185
23187 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOF (FVAL,IDEC)
      IMPLICIT NONE
      REAL*4 FVAL
      INTEGER IDEC,IDP,LEN
      REAL FRACT,WVAL
      INTEGER REQ,IPAD,FINT,KK,K,ILEN
      INTEGER ITOC,LENGTH
      LOGICAL*1 CWVAL(100)
      LOGICAL*1 CFINT(100)
      LOGICAL*1 RESULT(100)
      LOGICAL*1 BLANKS(9)
      LOGICAL*1 ZEROES(9)
      DATA BLANKS(1)/32/,BLANKS(2)/32/,BLANKS(3)/32/,BLANKS(4)/32/,BLANK
     *S(5)/32/,BLANKS(6)/32/,BLANKS(7)/32/,BLANKS(8)/32/,BLANKS(9)/0/
      DATA ZEROES(1)/48/,ZEROES(2)/48/,ZEROES(3)/48/,ZEROES(4)/48/,ZEROE
     *S(5)/48/,ZEROES(6)/48/,ZEROES(7)/48/,ZEROES(8)/48/,ZEROES(9)/0/
      LEN =IDEC/100
      IDP =IDEC -LEN*100
      IF(.NOT.(IDP.GT.8))GOTO 23192
      IDP =8
23192 CONTINUE
      IF(.NOT.(ABS(FVAL).LT.1.0))GOTO 23194
      REQ =1
      IF(.NOT.(FVAL.LT.0.0))GOTO 23196
      REQ =REQ +1
23196 CONTINUE
      GOTO 23195
23194 CONTINUE
      REQ =LOG10(ABS(AINT(FVAL))) +1
      IF(.NOT.(FVAL.LT.0.0))GOTO 23198
      REQ =REQ +1
23198 CONTINUE
23195 CONTINUE
      IF(.NOT.(LEN.LT.IDP+REQ))GOTO 23200
      LEN =IDP +REQ
23200 CONTINUE
      GOTO 6001
10    LEN =LEN +1
6001  WVAL =ABS(AINT(FVAL))
      FRACT =FVAL -WVAL
      FINT =FRACT *10**IDP +0.5
      IF(.NOT.(FINT.EQ.10**IDP))GOTO 23202
      IF(.NOT.(FVAL.GE.0.0))GOTO 23204
      WVAL=WVAL+1
      GOTO 23205
23204 CONTINUE
      WVAL=WVAL-1
23205 CONTINUE
23202 CONTINUE
      IPAD =LEN -REQ -IDP -1
      ILEN =ITOC(INT(WVAL),CWVAL,REQ+1)
      ILEN =ITOC(FINT,CFINT,IDP+1)
      KK =0
      IF(.NOT.(IPAD.GT.0))GOTO 23206
      CALL SMOVH(BLANKS ,IPAD,RESULT,KK)
23206 CONTINUE
      IF(.NOT.(FVAL.LT.0.0))GOTO 23208
      CALL SMOV(45,RESULT,KK)
23208 CONTINUE
      CALL SMOVH (CWVAL,REQ,RESULT,KK)
      CALL SMOV (46,RESULT,KK)
      CALL SMOVH (CFINT,IDP,RESULT,KK)
      IF(.NOT.(LENGTH(CFINT).LT.IDP))GOTO 23210
      CALL SMOVH(ZEROES,IDP -LENGTH(CFINT),RESULT,KK)
23210 CONTINUE
      CALL ECHOH (RESULT,LEN)
      RETURN
      END
      SUBROUTINE ECHOI(I)
      IMPLICIT NONE
      INTEGER I,J,K
      LOGICAL*1 STRNG(21)
      STRNG(11) =0
      K =IABS(I)
      J =20
23212 IF(.NOT.(J.GT.0))GOTO 23214
      STRNG(J) =MOD(K,10) +48
      K =K/10
23213 J=J-1
      GOTO 23212
23214 CONTINUE
      J=1
23215 IF(.NOT.(J.LT.20))GOTO 23217
      IF(.NOT.(STRNG(J).NE.48))GOTO 23218
      GOTO 23217
23218 CONTINUE
23216 J=J+1
      GOTO 23215
23217 CONTINUE
      IF(.NOT.(I.LT.0))GOTO 23220
      CALL ECHO (45)
23220 CONTINUE
      CALL ECHOST_H(STRNG(J))
      RETURN
      END
      SUBROUTINE ECHOIZ(I,N)
      IMPLICIT NONE
      INTEGER I,J,K,N,ISIGN,IFILL
      LOGICAL*1 STRNG(11)
      IFILL =48
      GO TO 100
      ENTRY ECHOIB(I,N)
      IFILL =32
100   STRNG(11) =0
      K =IABS(I)
      J =1
23222 IF(.NOT.(J.LE.10))GOTO 23224
      STRNG(J) =MOD(K,10) +48
      K =K/10
23223 J=J+1
      GOTO 23222
23224 CONTINUE
      J=10
23225 IF(.NOT.(J.GT.1))GOTO 23227
      IF(.NOT.(STRNG(J).NE.48))GOTO 23228
      GOTO 23227
23228 CONTINUE
23226 J=J-1
      GOTO 23225
23227 CONTINUE
      IF(.NOT.(I.LT.0))GOTO 23230
      ISIGN =45
      GOTO 23231
23230 CONTINUE
      ISIGN =IFILL
23231 CONTINUE
      K=N
23232 IF(.NOT.(K.GE.1))GOTO 23234
      IF(.NOT.(IFILL.EQ.48.AND.ISIGN.EQ.45))GOTO 23235
      CALL ECHO(ISIGN)
      ISIGN =IFILL
      GOTO 23233
23235 CONTINUE
      IF(.NOT.(K-1.EQ.J))GOTO 23237
      CALL ECHO(ISIGN)
      GOTO 23238
23237 CONTINUE
      IF(.NOT.(K.GT.J))GOTO 23239
      CALL ECHO(IFILL)
      GOTO 23240
23239 CONTINUE
      CALL ECHO(STRNG(K))
23240 CONTINUE
23238 CONTINUE
23233 K=K-1
      GOTO 23232
23234 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOO (IVAL,ILEN)
      IMPLICIT NONE
      INTEGER I,J,K,IVAL,ILEN
      I =IVAL
      K=(ILEN-1)*3
23241 IF(.NOT.(K.GE.0))GOTO 23243
      J =IAND(ISHFT(I,-(K)),'0007'X)
      CALL ECHO (J+48)
23242 K=K-3
      GOTO 23241
23243 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOX (IVAL,ILEN)
      IMPLICIT NONE
      INTEGER I,J,K,IVAL,ILEN
      I =IVAL
      K=(ILEN-1)*4
23244 IF(.NOT.(K.GE.0))GOTO 23246
      J =IAND(ISHFT(I,-(K)),'000F'X)
      IF(.NOT.(J.LE.9))GOTO 23247
      CALL ECHO (J+48)
      GOTO 23248
23247 CONTINUE
      CALL ECHO (65-10+J)
23248 CONTINUE
23245 K=K-4
      GOTO 23244
23246 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOB (IVAL,ILEN)
      IMPLICIT NONE
      INTEGER I,J,K,IVAL,ILEN
      I =IVAL
      K=(ILEN-1)
23249 IF(.NOT.(K.GE.0))GOTO 23251
      J =IAND(ISHFT(I,-(K)),'0001'X)
      CALL ECHO (J+48)
23250 K=K-1
      GOTO 23249
23251 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOBN (IVAL,ILEN)
      IMPLICIT NONE
      INTEGER I,J,K,IVAL,IBITS,ILEN
      I =IVAL
      IBITS =0
      K=(ILEN-1)
23252 IF(.NOT.(K.GE.0))GOTO 23254
      J =IAND(ISHFT(I,-(K)),'0001'X)
      IBITS =IBITS +J
      IF(.NOT.(IBITS.NE.0.OR.K.EQ.0))GOTO 23255
      CALL ECHO (J+48)
23255 CONTINUE
23253 K=K-1
      GOTO 23252
23254 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOLN(STRNG)
      IMPLICIT NONE
      LOGICAL*1 STRNG(100)
      CALL ECHOST_H(STRNG)
      CALL ECHOR
      RETURN
      END
      SUBROUTINE ECHOST(VSTR)
      IMPLICIT NONE
      INTEGER VLEN
      INTEGER I
      CHARACTER *(*) VSTR
      LOGICAL*1 HSTR(100)
      VLEN =LEN(VSTR)
      I=1
23257 IF(.NOT.(I.LE.VLEN))GOTO 23259
      CALL ECHO(ICHAR(VSTR(I:I)))
23258 I=I+1
      GOTO 23257
23259 CONTINUE
      RETURN
      ENTRY ECHOST_H (HSTR)
      I=1
23260 IF(.NOT.(HSTR(I).NE.0))GOTO 23262
      CALL ECHO(HSTR(I))
23261 I=I+1
      GOTO 23260
23262 CONTINUE
      RETURN
      END
      SUBROUTINE ECHOR
      IMPLICIT NONE
      CALL ECHO (13)
      CALL ECHO (0)
      CALL ECHO (0)
      CALL ECHO (10)
      CALL ECHO (0)
      CALL ECHO (0)
      RETURN
      END
      SUBROUTINE ECHOP(VCHARS)
      IMPLICIT NONE
      INTEGER IERR
      INTEGER ICHAR
      INTEGER HOLD,LCOUNT,FLOW,PLINES,TEE,XJFN,NJFN
      CHARACTER *4 VCHARS
      DATA HOLD/0/,LCOUNT/0/,FLOW/0/,PLINES/22/,TEE/0/,XJFN/6/
      LOGICAL*1 CHAR,ICHARX,ACHAR
      IF(.NOT.(VCHARS.EQ.'FON'))GOTO 23263
      FLOW =1
      GOTO 23264
23263 CONTINUE
      IF(.NOT.(VCHARS.EQ.'FOFF'))GOTO 23265
      FLOW =0
      LCOUNT=0
      GOTO 23266
23265 CONTINUE
      IF(.NOT.(VCHARS.EQ.'TEE'))GOTO 23267
      GOTO 23268
23267 CONTINUE
      IF(.NOT.(VCHARS.EQ.'XTEE'))GOTO 23269
      TEE =0
      CALL FCLOSF (XJFN,0,IERR)
      XJFN =6
      GOTO 23270
23269 CONTINUE
      IF(.NOT.(VCHARS.EQ.'CTEE'))GOTO 23271
      TEE =1
      GOTO 23272
23271 CONTINUE
      IF(.NOT.(VCHARS.EQ.'NTEE'))GOTO 23273
      TEE =0
      GOTO 23274
23273 CONTINUE
      IF(.NOT.(VCHARS.EQ.'RELS'))GOTO 23275
      HOLD =0
      GOTO 23276
23275 CONTINUE
      IF(.NOT.(VCHARS.EQ.'HOLD'))GOTO 23277
      HOLD =1
      GOTO 23278
23277 CONTINUE
      IF(.NOT.(VCHARS.EQ.'EOFF'))GOTO 23279
      CALL ECHOFF
      GOTO 23280
23279 CONTINUE
      IF(.NOT.(VCHARS.EQ.'CLR'))GOTO 23281
      LCOUNT =0
      GOTO 23282
23281 CONTINUE
      IF(.NOT.(VCHARS.EQ.'P22'))GOTO 23283
      PLINES =22
      GOTO 23284
23283 CONTINUE
      IF(.NOT.(VCHARS.EQ.'P38'))GOTO 23285
      PLINES =38
      GOTO 23286
23285 CONTINUE
23286 CONTINUE
23284 CONTINUE
23282 CONTINUE
23280 CONTINUE
23278 CONTINUE
23276 CONTINUE
23274 CONTINUE
23272 CONTINUE
23270 CONTINUE
23268 CONTINUE
23266 CONTINUE
23264 CONTINUE
      RETURN
      ENTRY ECHOP_B(ACHAR)
      CHAR =ACHAR
      IF(.NOT.(HOLD.EQ.0))GOTO 23287
      CALL TTYOUT (CHAR)
23287 CONTINUE
      IF(.NOT.(TEE.EQ.1))GOTO 23289
      IF(.NOT.(CHAR.EQ.13))GOTO 23291
      CHAR =0
23291 CONTINUE
      IF(.NOT.(CHAR.EQ.27))GOTO 23293
      CALL FBOUT (XJFN,ICHAR('<'),IERR,*8010)
      CALL FBOUT (XJFN,ICHAR('E'),IERR,*8010)
      CALL FBOUT (XJFN,ICHAR('s'),IERR,*8010)
      CALL FBOUT (XJFN,ICHAR('c'),IERR,*8010)
      CALL FBOUT (XJFN,ICHAR('>'),IERR,*8010)
      GOTO 23294
23293 CONTINUE
      IF(.NOT.(CHAR.NE.0))GOTO 23295
      CALL FBOUT (XJFN,CHAR,IERR,*8010)
23295 CONTINUE
23294 CONTINUE
23289 CONTINUE
      IF(.NOT.(FLOW.EQ.0))GOTO 23297
      RETURN
23297 CONTINUE
      IF(.NOT.(CHAR.EQ.12))GOTO 23299
      LCOUNT=PLINES
      GOTO 23300
23299 CONTINUE
      IF(.NOT.(CHAR.NE.10))GOTO 23301
      RETURN
23301 CONTINUE
23300 CONTINUE
      LCOUNT =LCOUNT +1
      IF(.NOT.(LCOUNT.LT.PLINES))GOTO 23303
      RETURN
23303 CONTINUE
      CALL TTYOUT (7)
23305 IF(.NOT.(.TRUE.))GOTO 23306
      CALL TTYDLY (ICHARX,8000)
      IF(.NOT.(ICHARX.EQ.16))GOTO 23307
      FLOW =0
      LCOUNT =0
      GOTO 23306
23307 CONTINUE
      IF(.NOT.(ICHARX.EQ.17.OR.ICHARX.EQ.32))GOTO 23309
      LCOUNT =0
      GOTO 23306
23309 CONTINUE
      IF(.NOT.(ICHARX.EQ.0))GOTO 23311
      GOTO 23312
23311 CONTINUE
      CALL TTYOUT (7)
23312 CONTINUE
23310 CONTINUE
      GOTO 23305
23306 CONTINUE
      RETURN
      ENTRY ECHOP_TEE (NJFN)
      IF(.NOT.(NJFN.EQ.0))GOTO 23313
      XJFN =6
      GOTO 23314
23313 CONTINUE
      XJFN =NJFN
23314 CONTINUE
      TEE =1
      RETURN
8010  CALL FCLOSF (XJFN,0,IERR)
      XJFN =6
      RETURN
      END
      FUNCTION IGBYTE (IT,IPOS)
      IMPLICIT NONE
      INTEGER IPOS
      LOGICAL*1 IGBYTE
      LOGICAL*1 IT(100)
      IGBYTE =IT(IPOS)
      RETURN
      END
      SUBROUTINE IPBYTE (IT,IPOS,IBYTE)
      IMPLICIT NONE
      INTEGER IPOS
      LOGICAL*1 IT(100),IBYTE
      IT(IPOS) =IBYTE
      RETURN
      END
      REAL*8 FUNCTION CSTRIP(CHARS,POS,NBRCHARS)
      IMPLICIT NONE
      REAL*8 NAME
      INTEGER I,NBRCHARS,POS
      LOGICAL*1 CHARS(100),DEST(8)
      EQUIVALENCE (NAME,DEST)
      IF(.NOT.(CHARS(POS).EQ.0))GOTO 23315
      CSTRIP =0
      RETURN
23315 CONTINUE
      NAME ='2020202020202020'X
      I=0
23317 IF(.NOT.(I.LT.NBRCHARS))GOTO 23319
      DEST(I+1) =CHARS(I+POS)
23318 I=I+1
      GOTO 23317
23319 CONTINUE
      CSTRIP =NAME
      RETURN
      END
      SUBROUTINE CDRESS(WORD,CHARS,POS,NBRCHARS)
      IMPLICIT NONE
      INTEGER I,NBRCHARS,POS
      LOGICAL*1 WORD(8),CHARS(100)
      I=0
23320 IF(.NOT.(I.LT.NBRCHARS))GOTO 23322
      CHARS(I+POS) =WORD(I+1)
23321 I=I+1
      GOTO 23320
23322 CONTINUE
      RETURN
      END
      REAL*8 FUNCTION CSTRIP8(SOURCE)
      IMPLICIT NONE
      REAL*8 SOURCE
      CSTRIP8 =SOURCE
      RETURN
      END
      SUBROUTINE CDRESS8(SOURCE,DEST)
      IMPLICIT NONE
      REAL*8 SOURCE,DEST
      DEST =SOURCE
      END
